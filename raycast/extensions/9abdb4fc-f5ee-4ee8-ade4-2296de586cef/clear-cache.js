"use strict";var l=Object.defineProperty;var C=Object.getOwnPropertyDescriptor;var D=Object.getOwnPropertyNames;var S=Object.prototype.hasOwnProperty;var v=(e,t)=>{for(var s in t)l(e,s,{get:t[s],enumerable:!0})},I=(e,t,s,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let c of D(t))!S.call(e,c)&&c!==s&&l(e,c,{get:()=>t[c],enumerable:!(n=C(t,c))||n.enumerable});return e};var k=e=>I(l({},"__esModule",{value:!0}),e);var z={};v(z,{default:()=>w});module.exports=k(z);var a=require("@raycast/api");var u=require("@raycast/api");var m=require("@raycast/api");var{messageLimit:O}=(0,m.getPreferenceValues)(),A=parseInt(O);var h=(e,t=864e5)=>Date.now()-e>t,o=new u.Cache,J=()=>{o.clear()},p=()=>{if(o.has("accounts")){let e=o.get("accounts");if(e){let{time:t,data:s}=JSON.parse(e);if(!h(t))return s}}},L=e=>p()?.find(t=>t.id===e||t.name===e),P=e=>{o.set("accounts",JSON.stringify({time:Date.now(),data:e}))},i=new u.Cache,$=()=>{i.clear()},g=(e,t)=>{let s=`${e}-${t}`;if(i.has(s)){let n=i.get(s);if(n){let{time:c,data:r}=JSON.parse(n);if(!h(c))return r.slice(0,A)}}return[]},d=(e,t,s)=>{let n=`${t}-${s}`;i.set(n,JSON.stringify({time:Date.now(),data:e}))},N=(e,t,s)=>{let c=[...g(t,s),e];d(c,t,s)},F=(e,t,s,n)=>{let r=g(s,n).map(f=>f.id===e?{...f,...t}:f);d(r,s,n)},V=(e,t,s)=>{let c=g(t,s).filter(r=>r.id!==e);d(c,t,s)},y=new u.Cache,W=()=>{let e=p();if(!e||e.length===0)return;let t=y.get("default-account-id");if(t){let s=e.find(n=>n.id===t);if(s)return s}return e[0]},j=e=>{y.set("default-account-id",e)},M=Object.freeze({getAccounts:p,setAccounts:P,getDefaultAccount:W,setDefaultAccount:j,getAccount:L,invalidateAccounts:J,getMessages:g,setMessages:d,addMessage:N,updateMessage:F,deleteMessage:V,invalidateMessages:$});async function w(){await(0,a.closeMainWindow)(),await(0,a.showToast)(a.Toast.Style.Animated,"Clearing cache"),M.invalidateMessages(),M.invalidateAccounts(),await(0,a.showToast)(a.Toast.Style.Success,"All mails and accounts cleared from cache")}
